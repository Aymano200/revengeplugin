(function(u,i,d,s,t,x,v){"use strict";function M(e,o=2){if(!+e)return"0 Bytes";const r=1024,a=o<0?0:o,n=["Bytes","KB","MB","GB","TB"],p=Math.floor(Math.log(e)/Math.log(r));return`${parseFloat((e/Math.pow(r,p)).toFixed(a))} ${n[p]}`}const{NativeModules:h}=d.ReactNative;h.NativeFileModule??h.RTNFileManager??h.DCDFileManager;async function w(e){try{console.log("[CatboxUploader] Media object:",e);const o=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!o)throw new Error("Missing file URI");const r=t.storage.userhash?.trim(),a=new FormData;a.append("reqtype","fileupload"),r&&a.append("userhash",r),a.append("fileToUpload",{uri:o,name:e.filename??"upload",type:e.mimeType??"application/octet-stream"});const n=await(await fetch("https://catbox.moe/user/api.php",{method:"POST",body:a})).text();if(console.log("[CatboxUploader] Raw response:",n),!n.startsWith("https://"))throw new Error(n);return n}catch(o){return console.error("[CatboxUploader] Upload failed:",o),null}}const{FormInput:T,FormDivider:y,FormSwitchRow:b}=x.Forms;function g(){return v.useProxy(t.storage),React.createElement(d.ReactNative.ScrollView,{style:{flex:1}},React.createElement(T,{title:"Catbox Userhash",placeholder:"Required for uploads to user account",value:t.storage.userhash||"",onChange:function(e){return t.storage.userhash=e.trim()},helpText:t.storage.userhash?null:React.createElement(d.ReactNative.Text,{style:{color:"#989898"}},"Optional")}),React.createElement(y,null),React.createElement(b,{label:"Always upload to Catbox",subLabel:"Ignore 10MB size limit",value:!!t.storage.alwaysUpload,onValueChange:function(e){t.storage.alwaysUpload=e}}),React.createElement(y,null),React.createElement(b,{label:"Show result link copy dialog",subLabel:"Uncheck to send link to chat automatically",value:!!t.storage.showDialogAfterUpload,onValueChange:function(e){t.storage.showDialogAfterUpload=e}}))}const l=i.findByProps("show","confirm","close"),f=i.findByProps("CloudUpload")?.CloudUpload,U=i.findByProps("sendMessage"),R=i.findByProps("getChannelId");let m=[];function D(){typeof t.storage.alwaysUpload!="boolean"&&(t.storage.alwaysUpload=!1),typeof t.storage.showDialogAfterUpload!="boolean"&&(t.storage.showDialogAfterUpload=!0)}function B(e=6){const o="abcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let a=0;a<e;a++)r+=o.charAt(Math.floor(Math.random()*o.length));return r}function E(){const e=`warmup_${B()}.bin`,o=Math.floor(Math.random()*1048576)+1;return{uri:"data:application/octet-stream;base64,AA==",filename:e,mimeType:"application/octet-stream",preCompressionSize:o}}function A(){setTimeout(async function(){try{await w(E()),console.log("[CatboxUploader] Warm-up upload complete")}catch(e){console.warn("[CatboxUploader] Warm-up upload failed",e)}},0)}function S(){const e=l.show;l.show=function(o){const r=o?.title?.toLowerCase?.()||"",a=o?.body?.toLowerCase?.()||"";if(r.includes("file cannot be empty")||a.includes("file cannot be empty")){console.log("[CatboxUploader] Suppressed Discord's default dialog");return}return e.call(this,o)},m.push(function(){l.show=e})}var F={onLoad(){D(),S();const e=f.prototype.reactNativeCompressAndExtractData;f.prototype.reactNativeCompressAndExtractData=async function(){const o=this,r=!!t.storage.alwaysUpload,a=!!t.storage.showDialogAfterUpload,n=o?.preCompressionSize??0,p=M(n);if(!(r||n>10*1024*1024))return e.apply(this,arguments);s.showToast(`Uploading ${p} to Catbox...`);try{const c=await w(o);if(c)if(a)l.show({title:"Upload Successful",body:c,confirmText:"Copy Link",cancelText:"Close",confirmColor:"brand",onConfirm:function(){d.ReactNative.Clipboard.setString(c),s.showToast("Copied to clipboard!"),l.close()},onCancel:function(){return l.close()}});else{const C=R?.getChannelId?.();C&&U?.sendMessage?(await U.sendMessage(C,{content:c}),s.showToast("Sent Catbox link.")):s.showToast("Upload succeeded, but could not send link.")}else s.showToast("Upload failed.")}catch(c){console.error("[CatboxUploader] Upload error:",c),s.showToast("Upload error occurred.")}return{compressed:!0,size:1337,uri:"catbox://upload"}},m.push(function(){f.prototype.reactNativeCompressAndExtractData=e}),A(),this.settings=g},onUnload(){m.forEach(function(e){return e()})},settings:g};return u.default=F,Object.defineProperty(u,"__esModule",{value:!0}),u})({},vendetta.metro,vendetta.metro.common,vendetta.ui.toasts,vendetta.plugin,vendetta.ui.components,vendetta.storage);
