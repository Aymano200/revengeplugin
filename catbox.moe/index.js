(function(v,r,n,m,Y,p){"use strict";const{NativeModules:F}=r.ReactNative;F.NativeFileModule??F.RTNFileManager??F.DCDFileManager;let D=null;async function V(e){try{const t=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!t)throw new Error("Missing file URI");D=e.filename??"upload";const o=n.storage.userhash?.trim(),a=new FormData;a.append("reqtype","fileupload"),o&&a.append("userhash",o),a.append("fileToUpload",{uri:t,name:D,type:e.mimeType??"application/octet-stream"});const l=await(await fetch("https://catbox.moe/user/api.php",{method:"POST",body:a})).text();if(console.log("[CatboxUploader] Raw response:",l),!l.startsWith("https://"))throw new Error(l);return l}catch(t){return console.error("[CatboxUploader] Upload failed:",t),null}}const{NativeModules:B}=r.ReactNative;B.NativeFileModule??B.RTNFileManager??B.DCDFileManager;let H=null;async function O(e,t="1h"){try{const o=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!o)throw new Error("Missing file URI");H=e.filename??"upload";const a=new FormData;a.append("reqtype","fileupload"),a.append("time",t),a.append("fileToUpload",{uri:o,name:e.filename??"upload",type:e.mimeType??"application/octet-stream"});const l=await(await fetch("https://litterbox.catbox.moe/resources/internals/api.php",{method:"POST",body:a})).text();if(console.log("[LitterboxUploader] Raw response:",l),!l.startsWith("https://"))throw new Error(l);return l}catch(o){return console.error("[LitterboxUploader] Upload failed:",o),null}}function Z(e,t=2){if(!+e)return"0 Bytes";const o=1024,a=t<0?0:t,l=["Bytes","KB","MB","GB","TB"],s=Math.floor(Math.log(e)/Math.log(o));return`${parseFloat((e/Math.pow(o,s)).toFixed(a))} ${l[s]}`}function W(e=6){const t="abcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let a=0;a<e;a++)o+=t.charAt(Math.floor(Math.random()*t.length));return o}function j(e){return e<=3?1:e<=15?12:e<=27?24:72}function ee(){const e=`warmup_${W()}.bin`,t=Math.floor(Math.random()*1048576)+1;return{uri:"data:application/octet-stream;base64,AA==",filename:e,mimeType:"application/octet-stream",preCompressionSize:t}}function te(){setTimeout(async function(){const e=ee();try{const t=await V(e);console.log(`[WarmUp] Catbox upload complete: ${t}`)}catch(t){console.warn("[WarmUp] Catbox upload failed:",t)}try{const t=await O(e,"1h");console.log(`[WarmUp] Litterbox upload complete: ${t}`)}catch(t){console.warn("[WarmUp] Litterbox upload failed:",t)}},0)}const{ScrollView:ae}=m.findByProps("ScrollView"),{TableRowGroup:y,TableSwitchRow:g,Stack:w}=m.findByProps("TableSwitchRow","TableRowGroup","Stack"),{TextInput:E}=m.findByProps("TextInput"),i=function(e,t=""){return n.storage[e]??t},c=function(e,t){return n.storage[e]=t};function q(){const[e,t]=r.React.useReducer(function(s){return~s},0),o=function(){return t()},a=i("selectedHost","catbox"),l=function(s){c("selectedHost",s),o()};return r.React.createElement(ae,{style:{flex:1}},r.React.createElement(w,{spacing:8,style:{padding:10}},r.React.createElement(y,{title:"Upload Settings"},r.React.createElement(g,{label:"Always upload to file hosters",subLabel:"Ignore the 10MBs file size limit to trigger upload",value:!!i("alwaysUpload"),onValueChange:function(s){c("alwaysUpload",s),o()}}),r.React.createElement(g,{label:"Copy link to clipboard",subLabel:"Disable to automatically send link to chat",value:!!i("copy"),onValueChange:function(s){c("copy",s),o()}}),r.React.createElement(g,{label:"AnonymousFileNames",subLabel:"Disable to use actual file name for hyperlinking",value:!!i("useAnonymousFileName"),onValueChange:function(s){c("useAnonymousFileName",s),o()}})),r.React.createElement(y,{title:"Default File Hoster"},r.React.createElement(g,{label:"Catbox",subLabel:"https://catbox.moe/",value:a==="catbox",onValueChange:function(){return l("catbox")}}),r.React.createElement(g,{label:"Litterbox",subLabel:"https://litterbox.catbox.moe/",value:a==="litterbox",onValueChange:function(){return l("litterbox")}}),r.React.createElement(g,{label:"Pomf",subLabel:"https://pomf.lain.la/",value:a==="pomf",onValueChange:function(){return l("pomf")}})),r.React.createElement(y,{title:"Litterbox default duration(hours)"},r.React.createElement(w,{spacing:4},r.React.createElement(E,{placeholder:"e.g. 24",value:i("defaultDuration"),onChange:function(s){c("defaultDuration",s),o()},isClearable:!0}))),r.React.createElement(y,{title:"Litterbox Custom Command Name"},r.React.createElement(w,{spacing:4},r.React.createElement(E,{placeholder:"e.g. /litterbox",value:i("commandName"),onChange:function(s){c("commandName",s),o()},isClearable:!0}))),r.React.createElement(y,{title:"Proxy Settings"},r.React.createElement(g,{label:"Use Proxy Server",value:!!i("useProxy"),onValueChange:function(s){c("useProxy",s),o()}})),r.React.createElement(y,{title:"Proxy Base URL"},r.React.createElement(w,{spacing:4},r.React.createElement(E,{placeholder:"https://your-proxy.com",value:i("proxyBaseUrl"),onChange:function(s){c("proxyBaseUrl",s),o()},isClearable:!0}))),r.React.createElement(y,{title:"Catbox Userhash"},r.React.createElement(w,{spacing:4},r.React.createElement(E,{placeholder:"Userhash",value:i("userhash"),onChange:function(s){c("userhash",s),o()},isClearable:!0})))))}let L=null;function oe(e){L=e}function re(){const e=L;return L=null,e}let M=null;function ne(){if(M)return;const e=(n.storage.commandName||"litterbox").replace(/^\//,"");M=Y.registerCommand({name:e,description:"Set Litterbox duration for the next upload (in hours)",options:[{name:"duration",description:"Duration (e.g., 1, 12, 24, 72)",type:3,required:!1}],execute(t){const o=t[0]?.value??"",a=parseInt(o);if(isNaN(a))return;const l=j(a);oe(`${l}h`),p.showToast(`Duration set to ${l}h for the next upload.`)}}),console.log(`[LitterboxUploader] Registered /${e} command`)}function le(){M?.(),M=null}const{NativeModules:$}=r.ReactNative;$.NativeFileModule??$.RTNFileManager??$.DCDFileManager;let S=null;async function se(e){try{const t=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!t)throw new Error("Missing file URI");S=e.filename??"upload";const o=new FormData;o.append("files[]",{uri:t,name:S,type:e.mimeType??"application/octet-stream"});const a=await(await fetch("https://pomf.lain.la/upload.php",{method:"POST",body:o})).json();if(console.log("[PomfUploader] Raw response:",a),!a?.success)throw new Error(a?.error??"Unknown error");const l=a?.files?.[0];if(!l?.url)throw new Error("No URL returned from Pomf");return l.url}catch(t){return console.error("[PomfUploader] Upload failed:",t),null}}const{NativeModules:A}=r.ReactNative;A.NativeFileModule??A.RTNFileManager??A.DCDFileManager;let z=null;async function ie(e,{uploadId:t,filename:o,proxyBaseUrl:a,userhash:l,destination:s,duration:N="1h"}){try{const b=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!b)throw new Error("Missing file URI");z=o;const u=new FormData;u.append("destination",s),u.append("time",N),l&&u.append("userhash",l),u.append("file",{uri:b,name:o,type:e.mimeType??"application/octet-stream"});const C=await fetch(`${a}/direct`,{method:"POST",body:u}),d=await C.json();if(console.log("[ProxyUploader] Response:",d),!C.ok||!d?.url)throw new Error(d?.error??"Unknown upload error");return d.url}catch(b){return console.error("[ProxyUploader] Upload error:",b),null}}const G=m.findByProps("sendMessage"),ce=m.findByProps("getChannelId"),_=m.findByProps("getPendingMessages","deletePendingMessage");function ue(){typeof n.storage.alwaysUpload!="boolean"&&(n.storage.alwaysUpload=!1),typeof n.storage.copy!="boolean"&&(n.storage.copy=!0),typeof n.storage.useProxy!="boolean"&&(n.storage.useProxy=!1),typeof n.storage.useAnonymousFileName!="boolean"&&(n.storage.useAnonymousFileName=!1),typeof n.storage.proxyBaseUrl!="string"&&(n.storage.proxyBaseUrl="https://fatboxog.onrender.com"),(typeof n.storage.defaultDuration!="string"||!/^\d+$/.test(n.storage.defaultDuration))&&(n.storage.defaultDuration="1"),typeof n.storage.commandName!="string"&&(n.storage.commandName="/litterbox"),["catbox","litterbox","pomf"].includes(n.storage.selectedHost)||(n.storage.selectedHost="catbox")}function de(e){try{const t=_?.getPendingMessages?.(e);if(!t)return;for(const[o,a]of Object.entries(t))a.state==="FAILED"&&(_.deletePendingMessage(e,o),console.log(`[catbox.moe] Deleted failed message: ${o}`))}catch(t){console.warn("[catbox.moe] Failed to delete pending messages:",t)}}function pe(){const e=m.findByProps("CloudUpload")?.CloudUpload,t=e.prototype.reactNativeCompressAndExtractData;return e.prototype.reactNativeCompressAndExtractData=async function(...o){const a=this,l=a?.preCompressionSize??0,s=Z(l);if(l>1024*1024*1024)return p.showToast("\u274C File too large (max 1 GB)"),null;const N=!!n.storage.alwaysUpload,b=!!n.storage.copy,u=!!n.storage.useProxy,C=!!n.storage.useAnonymousFileName,d=n.storage.selectedHost||"catbox";if(!(N||l>10*1024*1024))return t.apply(this,o);let P=re();const J=P!==null;P||(P=n.storage.defaultDuration||"1");let I=parseInt(P);isNaN(I)&&(I=1);const k=`${j(I)}h`,Q=l>200*1024*1024;let f="catbox";J?f="litterbox":Q?f=d==="catbox"?"litterbox":d:f=d;const X=f.charAt(0).toUpperCase()+f.slice(1),he=u?`proxied ${X}`:X;p.showToast(`\u{1F4E4} Uploading ${s} to ${he}...`),console.log("[Uploader] File size:",s),console.log("[Uploader] Upload decision:",{alwaysUpload:N,selectedHost:d,useProxy:u,useAnonymous:C,commandTriggered:J,useHost:f,duration:k,tooBigForCatbox:Q});let x=this?.channelId??ce?.getChannelId?.();try{let h=null,U=null;if(u){const R=Math.random().toString(36).slice(2,10),T=n.storage.proxyBaseUrl?.trim()||"";h=await ie(a,{uploadId:R,filename:a?.filename??"upload",proxyBaseUrl:T,userhash:n.storage.userhash,destination:f,duration:k}),U=z??"file"}else switch(f){case"litterbox":h=await O(a,k),U=H;break;case"pomf":h=await se(a),U=S;break;default:h=await V(a),U=D}if(typeof this.setStatus=="function"&&this.setStatus("CANCELED"),x&&setTimeout(function(){return de(x)},500),h){let R;if(C){const me=(U?.split(".").pop()??"bin").toLowerCase();R=`${W()}.${me}`}else R=U??"file";const T=`[${R}](${h})`;b?(r.ReactNative.Clipboard.setString(T),p.showToast("Copied to clipboard!")):x&&G?.sendMessage?(await G.sendMessage(x,{content:T}),p.showToast("Link sent to chat.")):p.showToast("Upload succeeded but could not send link.")}else console.warn("[Uploader] Upload failed, no link returned."),p.showToast("Upload failed.")}catch(h){console.error("[Uploader] Upload error:",h),p.showToast("Upload error occurred."),x&&setTimeout(function(){return deleteFailedMessages(x)},500)}return null},function(){e.prototype.reactNativeCompressAndExtractData=t}}let K=[];var fe={onLoad(){ue(),ne(),K.push(pe()),te(),console.log("[CatboxUploader] Plugin loaded."),this.settings=q},onUnload(){le(),K.forEach(function(e){return e()}),console.log("[CatboxUploader] Plugin unloaded.")},settings:q};return v.default=fe,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.metro.common,vendetta.plugin,vendetta.metro,vendetta.commands,vendetta.ui.toasts);
