(function(D,r,n,m,Y,f){"use strict";const{NativeModules:M}=r.ReactNative;M.NativeFileModule??M.RTNFileManager??M.DCDFileManager;let P=null;async function V(e){try{const t=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!t)throw new Error("Missing file URI");P=e.filename??"upload";const o=n.storage.userhash?.trim(),a=new FormData;a.append("reqtype","fileupload"),o&&a.append("userhash",o),a.append("fileToUpload",{uri:t,name:P,type:e.mimeType??"application/octet-stream"});const l=await(await fetch("https://catbox.moe/user/api.php",{method:"POST",body:a})).text();if(console.log("[CatboxUploader] Raw response:",l),!l.startsWith("https://"))throw new Error(l);return l}catch(t){return console.error("[CatboxUploader] Upload failed:",t),null}}const{NativeModules:F}=r.ReactNative;F.NativeFileModule??F.RTNFileManager??F.DCDFileManager;let H=null;async function W(e,t="1h"){try{const o=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!o)throw new Error("Missing file URI");H=e.filename??"upload";const a=new FormData;a.append("reqtype","fileupload"),a.append("time",t),a.append("fileToUpload",{uri:o,name:e.filename??"upload",type:e.mimeType??"application/octet-stream"});const l=await(await fetch("https://litterbox.catbox.moe/resources/internals/api.php",{method:"POST",body:a})).text();if(console.log("[LitterboxUploader] Raw response:",l),!l.startsWith("https://"))throw new Error(l);return l}catch(o){return console.error("[LitterboxUploader] Upload failed:",o),null}}function Z(e,t=2){if(!+e)return"0 Bytes";const o=1024,a=t<0?0:t,l=["Bytes","KB","MB","GB","TB"],s=Math.floor(Math.log(e)/Math.log(o));return`${parseFloat((e/Math.pow(o,s)).toFixed(a))} ${l[s]}`}function q(e=6){const t="abcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let a=0;a<e;a++)o+=t.charAt(Math.floor(Math.random()*t.length));return o}function z(e){return e<=3?1:e<=15?12:e<=27?24:72}function ee(){const e=`warmup_${q()}.bin`,t=Math.floor(Math.random()*1048576)+1;return{uri:"data:application/octet-stream;base64,AA==",filename:e,mimeType:"application/octet-stream",preCompressionSize:t}}function te(){setTimeout(async function(){const e=ee();try{const t=await V(e);console.log(`[WarmUp] Catbox upload complete: ${t}`)}catch(t){console.warn("[WarmUp] Catbox upload failed:",t)}try{const t=await W(e,"1h");console.log(`[WarmUp] Litterbox upload complete: ${t}`)}catch(t){console.warn("[WarmUp] Litterbox upload failed:",t)}},0)}const{ScrollView:ae}=m.findByProps("ScrollView"),{TableRowGroup:y,TableSwitchRow:b,Stack:x}=m.findByProps("TableSwitchRow","TableRowGroup","Stack"),{TextInput:R}=m.findByProps("TextInput"),i=function(e,t=""){return n.storage[e]??t},c=function(e,t){return n.storage[e]=t};function O(){const[e,t]=r.React.useReducer(function(s){return~s},0),o=function(){return t()},a=i("selectedHost","catbox"),l=function(s){c("selectedHost",s),o()};return r.React.createElement(ae,{style:{flex:1}},r.React.createElement(x,{spacing:8,style:{padding:10}},r.React.createElement(y,{title:"Upload Settings"},r.React.createElement(b,{label:"Always upload to file hosters",subLabel:"Ignore the 10MBs file size limit to trigger upload",value:!!i("alwaysUpload"),onValueChange:function(s){c("alwaysUpload",s),o()}}),r.React.createElement(b,{label:"Show result link copy dialog",subLabel:"Disable to auto send link to chat",value:!!i("showDialog"),onValueChange:function(s){c("showDialog",s),o()}}),r.React.createElement(b,{label:"AnonymousFileNames",subLabel:"Disable to use actual file name for hyperlinking",value:!!i("useAnonymousFileName"),onValueChange:function(s){c("useAnonymousFileName",s),o()}})),r.React.createElement(y,{title:"Default File Hoster"},r.React.createElement(b,{label:"Catbox",subLabel:"http://catbox.moe/",value:a==="catbox",onValueChange:function(){return l("catbox")}}),r.React.createElement(b,{label:"Litterbox",subLabel:"https://litterbox.catbox.moe/",value:a==="litterbox",onValueChange:function(){return l("litterbox")}}),r.React.createElement(b,{label:"Pomf",subLabel:"https://pomf.lain.la/",value:a==="pomf",onValueChange:function(){return l("pomf")}})),r.React.createElement(y,{title:"Litterbox default duration(hours)"},r.React.createElement(x,{spacing:4},r.React.createElement(R,{placeholder:"e.g. 24",value:i("defaultDuration"),onChange:function(s){c("defaultDuration",s),o()},isClearable:!0}))),r.React.createElement(y,{title:"Litterbox Custom Command Name"},r.React.createElement(x,{spacing:4},r.React.createElement(R,{placeholder:"e.g. /litterbox",value:i("commandName"),onChange:function(s){c("commandName",s),o()},isClearable:!0}))),r.React.createElement(y,{title:"Proxy Settings"},r.React.createElement(b,{label:"Use Proxy Server",value:!!i("useProxy"),onValueChange:function(s){c("useProxy",s),o()}})),r.React.createElement(y,{title:"Proxy Base URL"},r.React.createElement(x,{spacing:4},r.React.createElement(R,{placeholder:"https://your-proxy.com",value:i("proxyBaseUrl"),onChange:function(s){c("proxyBaseUrl",s),o()},isClearable:!0}))),r.React.createElement(y,{title:"Catbox Userhash"},r.React.createElement(x,{spacing:4},r.React.createElement(R,{placeholder:"Userhash",value:i("userhash"),onChange:function(s){c("userhash",s),o()},isClearable:!0})))))}let L=null;function oe(e){L=e}function re(){const e=L;return L=null,e}let E=null;function ne(){if(E)return;const e=(n.storage.commandName||"litterbox").replace(/^\//,"");E=Y.registerCommand({name:e,description:"Set Litterbox duration for the next upload (in hours)",options:[{name:"duration",description:"Duration (e.g., 1, 12, 24, 72)",type:3,required:!1}],execute(t){const o=t[0]?.value??"",a=parseInt(o);if(isNaN(a))return;const l=z(a);oe(`${l}h`),f.showToast(`Duration set to ${l}h for the next upload.`)}}),console.log(`[LitterboxUploader] Registered /${e} command`)}function le(){E?.(),E=null}const{NativeModules:B}=r.ReactNative;B.NativeFileModule??B.RTNFileManager??B.DCDFileManager;let S=null;async function se(e){try{const t=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!t)throw new Error("Missing file URI");S=e.filename??"upload";const o=new FormData;o.append("files[]",{uri:t,name:S,type:e.mimeType??"application/octet-stream"});const a=await(await fetch("https://pomf.lain.la/upload.php",{method:"POST",body:o})).json();if(console.log("[PomfUploader] Raw response:",a),!a?.success)throw new Error(a?.error??"Unknown error");const l=a?.files?.[0];if(!l?.url)throw new Error("No URL returned from Pomf");return l.url}catch(t){return console.error("[PomfUploader] Upload failed:",t),null}}const{NativeModules:$}=r.ReactNative;$.NativeFileModule??$.RTNFileManager??$.DCDFileManager;let j=null;async function ie(e,{uploadId:t,filename:o,proxyBaseUrl:a,userhash:l,destination:s,duration:N="1h"}){try{const g=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!g)throw new Error("Missing file URI");j=o;const u=new FormData;u.append("destination",s),u.append("time",N),l&&u.append("userhash",l),u.append("file",{uri:g,name:o,type:e.mimeType??"application/octet-stream"});const U=await fetch(`${a}/direct`,{method:"POST",body:u}),d=await U.json();if(console.log("[ProxyUploader] Response:",d),!U.ok||!d?.url)throw new Error(d?.error??"Unknown upload error");return d.url}catch(g){return console.error("[ProxyUploader] Upload error:",g),null}}const A=m.findByProps("show","close","confirm"),G=m.findByProps("sendMessage"),ce=m.findByProps("getChannelId");function ue(){typeof n.storage.alwaysUpload!="boolean"&&(n.storage.alwaysUpload=!1),typeof n.storage.showDialog!="boolean"&&(n.storage.showDialog=!0),typeof n.storage.useProxy!="boolean"&&(n.storage.useProxy=!1),typeof n.storage.useAnonymousFileName!="boolean"&&(n.storage.useAnonymousFileName=!1),typeof n.storage.proxyBaseUrl!="string"&&(n.storage.proxyBaseUrl="https://fatboxog.onrender.com"),(typeof n.storage.defaultDuration!="string"||!/^\d+$/.test(n.storage.defaultDuration))&&(n.storage.defaultDuration="1"),typeof n.storage.commandName!="string"&&(n.storage.commandName="/litterbox"),["catbox","litterbox","pomf"].includes(n.storage.selectedHost)||(n.storage.selectedHost="catbox")}function de(){const e=m.findByProps("CloudUpload")?.CloudUpload,t=e.prototype.reactNativeCompressAndExtractData;return e.prototype.reactNativeCompressAndExtractData=async function(...o){const a=this,l=a?.preCompressionSize??0,s=Z(l);if(l>1024*1024*1024)return f.showToast("\u274C File too large (max 1 GB)"),null;const N=!!n.storage.alwaysUpload,g=!!n.storage.showDialog,u=!!n.storage.useProxy,U=!!n.storage.useAnonymousFileName,d=n.storage.selectedHost||"catbox";if(!(N||l>10*1024*1024))return t.apply(this,o);let T=re();const K=T!==null;T||(T=n.storage.defaultDuration||"1");let k=parseInt(T);isNaN(k)&&(k=1);const I=`${z(k)}h`,J=l>200*1024*1024;let h="catbox";K?h="litterbox":J?h=d==="catbox"?"litterbox":d:h=d;const Q=h.charAt(0).toUpperCase()+h.slice(1),fe=u?`proxied ${Q}`:Q;f.showToast(`\u{1F4E4} Uploading ${s} to ${fe}...`),console.log("[Uploader] File size:",s),console.log("[Uploader] Upload decision:",{alwaysUpload:N,selectedHost:d,useProxy:u,useAnonymous:U,commandTriggered:K,useHost:h,duration:I,tooBigForCatbox:J});try{let p=null,w=null;if(u){const v=Math.random().toString(36).slice(2,10),C=n.storage.proxyBaseUrl?.trim()||"";p=await ie(a,{uploadId:v,filename:a?.filename??"upload",proxyBaseUrl:C,userhash:n.storage.userhash,destination:h,duration:I}),w=j??"file"}else switch(h){case"litterbox":p=await W(a,I),w=H;break;case"pomf":p=await se(a),w=S;break;default:p=await V(a),w=P}if(typeof this.setStatus=="function"&&this.setStatus("CANCELED"),p){const v=this?.channelId??ce?.getChannelId?.();let C;if(U){const he=(w?.split(".").pop()??"bin").toLowerCase();C=`${q()}.${he}`}else C=w??"file";const X=`[${C}](${p})`;g?A.show({title:"Upload Successful",body:X,confirmText:"Copy Link",cancelText:"Close",confirmColor:"brand",onConfirm:function(){r.ReactNative.Clipboard.setString(p),f.showToast("Copied to clipboard!"),A.close()},onCancel:function(){return A.close()}}):v&&G?.sendMessage?(await G.sendMessage(v,{content:X}),f.showToast("Link sent to chat.")):f.showToast("Upload succeeded but could not send link.")}else console.warn("[Uploader] Upload failed, no link returned."),f.showToast("Upload failed.")}catch(p){console.error("[Uploader] Upload error:",p),f.showToast("Upload error occurred.")}return null},function(){e.prototype.reactNativeCompressAndExtractData=t}}let _=[];var pe={onLoad(){ue(),ne(),_.push(de()),te(),console.log("[CatboxUploader] Plugin loaded."),this.settings=O},onUnload(){le(),_.forEach(function(e){return e()}),console.log("[CatboxUploader] Plugin unloaded.")},settings:O};return D.default=pe,Object.defineProperty(D,"__esModule",{value:!0}),D})({},vendetta.metro.common,vendetta.plugin,vendetta.metro,vendetta.commands,vendetta.ui.toasts);
