(function(h,t,i,$,F,A,l,d){"use strict";const{NativeModules:m}=i.ReactNative;m.NativeFileModule??m.RTNFileManager??m.DCDFileManager;async function R(e){try{const o=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!o)throw new Error("Missing file URI");const r=t.storage.userhash?.trim(),a=new FormData;a.append("reqtype","fileupload"),r&&a.append("userhash",r),a.append("fileToUpload",{uri:o,name:e.filename??"upload",type:e.mimeType??"application/octet-stream"});const n=await(await fetch("https://catbox.moe/user/api.php",{method:"POST",body:a})).text();if(console.log("[CatboxUploader] Raw response:",n),!n.startsWith("https://"))throw new Error(n);return n}catch(o){return console.error("[CatboxUploader] Upload failed:",o),null}}const{NativeModules:b}=i.ReactNative;b.NativeFileModule??b.RTNFileManager??b.DCDFileManager;async function v(e,o="1h"){try{const r=e?.item?.originalUri||e?.uri||e?.fileUri||e?.path||e?.sourceURL;if(!r)throw new Error("Missing file URI");const a=new FormData;a.append("reqtype","fileupload"),a.append("time",o),a.append("fileToUpload",{uri:r,name:e.filename??"upload",type:e.mimeType??"application/octet-stream"});const n=await(await fetch("https://litterbox.catbox.moe/resources/internals/api.php",{method:"POST",body:a})).text();if(console.log("[LitterboxUploader] Raw response:",n),!n.startsWith("https://"))throw new Error(n);return n}catch(r){return console.error("[LitterboxUploader] Upload failed:",r),null}}function B(e,o=2){if(!+e)return"0 Bytes";const r=1024,a=o<0?0:o,n=["Bytes","KB","MB","GB","TB"],p=Math.floor(Math.log(e)/Math.log(r));return`${parseFloat((e/Math.pow(r,p)).toFixed(a))} ${n[p]}`}function P(e=6){const o="abcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let a=0;a<e;a++)r+=o.charAt(Math.floor(Math.random()*o.length));return r}function D(e){return e<=3?1:e<=15?12:e<=27?24:72}function k(){const e=`warmup_${P()}.bin`,o=Math.floor(Math.random()*1048576)+1;return{uri:"data:application/octet-stream;base64,AA==",filename:e,mimeType:"application/octet-stream",preCompressionSize:o}}function I(){setTimeout(async function(){try{const e=t.storage.useLitterbox?"Litterbox":"Catbox",o=k(),r=t.storage.useLitterbox?await v(o,"1h"):await R(o);console.log(`[CatboxUploader] Warm-up upload complete: ${r}`)}catch(e){console.warn("[CatboxUploader] Warm-up upload failed",e)}},0)}const{FormInput:x,FormDivider:c,FormSwitchRow:g}=$.Forms;function T(){return F.useProxy(t.storage),React.createElement(i.ReactNative.ScrollView,{style:{flex:1}},React.createElement(x,{title:"Catbox Userhash",placeholder:"Required for uploads to catbox account",value:t.storage.userhash||"",onChange:function(e){return t.storage.userhash=e.trim()},helpText:t.storage.userhash?null:React.createElement(i.ReactNative.Text,{style:{color:"#989898"}},"Optional")}),React.createElement(c,null),React.createElement(g,{label:"Always upload to Catbox",subLabel:"Ignore the 10MBs limit of triggering catbox",value:!!t.storage.alwaysUpload,onValueChange:function(e){t.storage.alwaysUpload=e}}),React.createElement(c,null),React.createElement(g,{label:"Show result link copy dialog",subLabel:"Uncheck to send link to chat automatically",value:!!t.storage.showDialogAfterUpload,onValueChange:function(e){t.storage.showDialogAfterUpload=e}}),React.createElement(c,null),React.createElement(g,{label:"Use Litterbox instead of Catbox",subLabel:"Temporary uploads with duration on litterbox.moe",value:!!t.storage.useLitterbox,onValueChange:function(e){t.storage.useLitterbox=e}}),React.createElement(c,null),React.createElement(x,{title:"Default Litterbox Duration (hours)",placeholder:"1",keyboardType:"numeric",value:t.storage.defaultDuration||"1",onChange:function(e){/^\d*$/.test(e)&&(t.storage.defaultDuration=e)}}),React.createElement(c,null),React.createElement(x,{title:"Litterbox Upload Command [REQUIRES RESTART]",placeholder:"/litterbox",value:t.storage.commandName||"/litterbox",onChange:function(e){t.storage.commandName=e.startsWith("/")?e:`/${e}`},helpText:"Set Litterbox duration for the next upload, e.g. /litterbox 24 (yes you can leave it empty, idc)"}))}let y=null;function W(e){y=e}function q(){const e=y;return y=null,e}let u=null;function O(){if(u)return;const e=(t.storage.commandName||"litterbox").replace(/^\//,"");u=A.registerCommand({name:e,description:"Set Litterbox duration for the next upload (in hours)",options:[{name:"duration",description:"Duration (e.g., 1, 12, 24, 72)",type:3,required:!1}],execute(o){const r=o[0]?.value??"",a=parseInt(r);if(isNaN(a))return;const n=D(a);W(`${n}h`),l.showToast(`Duration set to ${n}h for the next upload.`)}}),console.log(`[CatboxUploader] Registered /${e} command`)}function V(){u?.(),u=null}const U=d.findByProps("show","close","confirm"),E=d.findByProps("sendMessage");d.findByProps("getChannelId");function z(){typeof t.storage.alwaysUpload!="boolean"&&(t.storage.alwaysUpload=!1),typeof t.storage.showDialogAfterUpload!="boolean"&&(t.storage.showDialogAfterUpload=!0),typeof t.storage.useLitterbox!="boolean"&&(t.storage.useLitterbox=!1),(typeof t.storage.defaultDuration!="string"||!/^\d+$/.test(t.storage.defaultDuration))&&(t.storage.defaultDuration="1"),typeof t.storage.commandName!="string"&&(t.storage.commandName="litterbox")}function _(){const e=d.findByProps("CloudUpload")?.CloudUpload,o=e.prototype.reactNativeCompressAndExtractData;return e.prototype.reactNativeCompressAndExtractData=async function(...r){const a=this,n=!!t.storage.alwaysUpload,p=!!t.storage.showDialogAfterUpload,G=!!t.storage.useLitterbox,w=a?.preCompressionSize??0,K=B(w);if(!(n||w>10*1024*1024))return o.apply(this,r);let f=q();const Q=f!==null;f||(f=t.storage.defaultDuration||"1");let C=parseInt(f);isNaN(C)&&(C=1);const M=`${D(C)}h`,N=!(w>200*1024*1024)&&(Q||G);console.log("[LitterboxUploader] Using duration:",M),l.showToast(`Uploading ${K} to ${N?"Litterbox":"Catbox"}...`);try{const s=N?await v(a,M):await R(a);if(typeof this.setStatus=="function"&&this.setStatus("CANCELED"),s)if(p)U.show({title:"Upload Successful",body:s,confirmText:"Copy Link",cancelText:"Close",confirmColor:"brand",onConfirm:function(){i.ReactNative.Clipboard.setString(s),l.showToast("Copied to clipboard!"),U.close()},onCancel:function(){return U.close()}});else{const S=this?.channelId;S&&E?.sendMessage?(await E.sendMessage(S,{content:s}),l.showToast("Sent link to chat.")):l.showToast("Upload succeeded, but could not send link.")}else console.warn("[CatboxUploader] Upload failed - no link returned"),l.showToast("Upload failed.")}catch(s){console.error("[CatboxUploader] Upload error:",s),l.showToast("Upload error occurred.")}return null},function(){e.prototype.reactNativeCompressAndExtractData=o}}let L=[];var j={onLoad(){z(),O(),L.push(_()),I(),console.log("[CatboxUploader] Plugin loaded."),this.settings=T},onUnload(){V(),L.forEach(function(e){return e()}),console.log("[CatboxUploader] Plugin unloaded.")},settings:T};return h.default=j,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.plugin,vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.commands,vendetta.ui.toasts,vendetta.metro);
