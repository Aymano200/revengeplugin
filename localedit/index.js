(function(f,n,h,a,M,S,A){"use strict";const p=n.findByProps("openLazy","hideActionSheet"),m=n.findByProps("ActionSheetRow")?.ActionSheetRow??S.Forms.FormRow,E=n.findByStoreName("MessageStore"),R=n.findByStoreName("UserStore"),l=n.findByProps("sendMessage","startEditMessage","editMessage"),r=new Map;let c=!1,s=[];var v={onLoad(){s.push(a.before("openLazy",p,function([i,y,g]){const t=g?.message;y!=="MessageLongPressActionSheet"||!t||i.then(function(d){const _=a.after("default",d,function(L,P){setTimeout(_,0);const u=A.findInReactTree(P,function(o){return o?.[0]?.type?.name==="ActionSheetRow"});if(!u)return;const B=R.getCurrentUser(),e=E.getMessage(t.channel_id,t.id)??t;if(e.author.id===B.id||u.some(function(o){return o?.props?.label==="Edit Locally"}))return;const N=Math.max(u.findIndex(function(o){return o.props.message===h.i18n.Messages.MARK_UNREAD}),0),b=function(){c=!0,r.has(e.id)||r.set(e.id,JSON.parse(JSON.stringify(e))),p.hideActionSheet(),l.startEditMessage(e.channel_id,e.id,e.content)};u.splice(N,0,React.createElement(m,{label:"Edit Locally",icon:React.createElement(m.Icon,{source:M.getAssetIDByName("ic_edit_24px")}),onPress:b}))})})})),s.push(a.before("editMessage",l,function(i){const[y,g,t]=i;if(c){const d=r.get(g);return d?(h.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...d,content:t.content,edited_timestamp:null},otherPluginBypass:!0}),!1):void 0}})),s.push(a.after("endEditMessage",l,function(){c&&(c=!1)}))},onUnload(){s.forEach(function(i){return i()}),s=[],r.clear()}};return f.default=v,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.components,vendetta.utils);
