(function(E,z,V,H,e,o,N,X,m,j,W,d,v,Y,b,O,S,M,F,x,G,Z){"use strict";var T={proxyUrl:"https://raw.githubusercontent.com/shipwr3ckd/plugin-tests/master/",customLinks:{"revenge.nexpid.xyz":function(t){return`https://github.com/nexpid/RevengePlugins/tree/main/src/plugins/${t.join("/")}`},"mugman.catvibers.me":function(t){return`https://github.com/mugman174/${t[0]}/tree/master/plugins/${t.slice(1).join("/")}`},"plugins.obamabot.me":function(t){return`https://github.com/WolfPlugs/${t[0]}/tree/master/${t.slice(1).join("/")}`}}};function D(t){return t.endsWith("/")?t:`${t}/`}const A={origin:/^([^/]+)\/(.*)/,multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/,rawGithub:/^raw\.githubusercontent\.com\/([^/]+)\/([^/]+)\/([^/]+)\/(.+)$/};function q(t){const n=t.match(A.multiplePluginGitio);if(n?.[0])return`https://github.com/${n[1]}/${n[2]}/tree/master/plugins/${n[3]}`;const u=t.match(A.singlePluginGitio)??t.match(A.githubReleases);if(u?.[0])return`https://github.com/${u[1]}/${u[2]}`;const i=t.match(A.rawGithub);if(i?.[0]){const[,f,c,h,R]=i;return`https://github.com/${f}/${c}/tree/${h}/${R.replace(/\/$/,"")}`}const r=t.match(A.origin);if(r){const[,f,c]=r;if(T.customLinks[f])return T.customLinks[f](c.split("/"))}}let L=new Array;function P(){return!L[0]||!k.pluginCache[0]?[]:L.filter(function(t){return!k.pluginCache.includes(t)})}function K(){k.pluginCache=L}async function $(t){L=(t??await(await j.safeFetch(`${T.proxyUrl}plugins.json`,{cache:"no-store"})).json()).map(function(n){return D(typeof n=="string"?n:n.vendetta.original)})}function J(){const t=setInterval($,36e5);return $(),function(){clearInterval(t)}}const{FormRow:Q}=M.Forms,_=e.stylesheet.createThemedStyleSheet({card:{padding:16,borderRadius:16,borderColor:S.semanticColors.BORDER_FAINT,borderWidth:1,backgroundColor:S.semanticColors.CARD_PRIMARY_BG},content:{flexDirection:"row",alignItems:"center",flex:1},title:{flexDirection:"row",alignItems:"center",gap:6,flexShrink:1},pluginIcon:{tintColor:S.semanticColors.LOGO_PRIMARY,width:18,height:18},actions:{flexDirection:"row-reverse",alignItems:"center",gap:5}});function ee(t){const n=_.card.backgroundColor,u=G.lerp(n,S.rawColors.BRAND_500,.08),i=d.Reanimated.useSharedValue(n);return e.React.useEffect(function(){i.value=n,t.highlight&&(i.value=d.Reanimated.withSequence(d.Reanimated.withTiming(u,{duration:500,easing:d.Reanimated.Easing.cubic}),d.Reanimated.withTiming(n,{duration:500,easing:d.Reanimated.Easing.cubic})))},[t.highlight]),e.React.createElement(d.Reanimated.default.View,{style:[_.card,{backgroundColor:i},t.broken&&{opacity:.5},t.warning&&{opacity:.7}]},e.React.createElement(v.Stack,{spacing:16},e.React.createElement(e.ReactNative.View,{style:_.content},e.React.createElement(v.Stack,{spacing:0,style:{flex:1}},e.React.createElement(e.ReactNative.View,{style:_.title},t.headerIcon&&e.React.createElement(e.ReactNative.Image,{style:_.pluginIcon,resizeMode:"cover",source:t.headerIcon}),e.React.createElement(x,{variant:"heading-lg/semibold",color:"HEADER_PRIMARY",lineClamp:1,ellipsis:"tail",style:{flexShrink:1}},t.headerLabel),t.headerSuffix),t.headerSublabel&&e.React.createElement(x,{variant:"text-md/semibold",color:"TEXT_MUTED"},t.headerSublabel)),e.React.createElement(e.ReactNative.View,null,e.React.createElement(v.Stack,{spacing:5,direction:"horizontal"},t.actions?.map(function(r){let{icon:f,onPress:c,isDestructive:h,loading:R}=r;return e.React.createElement(v.IconButton,{onPress:c,loading:R,size:"sm",variant:h?"destructive":"secondary",icon:o.getAssetIDByName(f)})}),t.overflowActions&&e.React.createElement(v.IconButton,{onPress:function(){F.showSimpleActionSheet({key:"CardOverflow",header:{title:t.overflowTitle,icon:t.headerIcon&&e.React.createElement(Q.Icon,{source:t.headerIcon}),onClose:F.hideActionSheet},options:t.overflowActions?.map(function(r){return{...r,icon:o.getAssetIDByName(r.icon)}})})},size:"sm",variant:"secondary",icon:o.getAssetIDByName("CircleInformationIcon-primary")})))),t.descriptionLabel&&e.React.createElement(x,{variant:"text-md/medium",color:"TEXT_NORMAL"},t.descriptionLabel)))}function te(t){let{item:n,changes:u}=t;const{usableLink:i,githubLink:r}=e.React.useMemo(function(){return{usableLink:`https://${n.vendetta.original.replace(/^vendetta\.nexpid\.xyz\//,"revenge.nexpid.xyz/")}`,githubLink:q(n.vendetta.original)}},[n]),f=e.React.useMemo(function(){return u.includes(D(n.vendetta.original))},[u,n]),[c,h]=e.React.useState({hasPlugin:!!b.plugins[i],pending:!1});e.React.useEffect(function(){h({hasPlugin:!!b.plugins[i],pending:!1})},[n,i]);const R=function(){if(c.pending)return;const a=!!b.plugins[i],w=async function(){h(function(B){return{...B,pending:!0}});try{a?b.removePlugin(i):await b.installPlugin(i)}catch{m.showToast(l.format(a?"toast.plugin.delete.fail":"toast.plugin.install.fail",{plugin:n.name}),o.getAssetIDByName("CircleXIcon-primary"))}m.showToast(l.format(a?"toast.plugin.delete.success":"toast.plugin.install.success",{plugin:n.name}),o.getAssetIDByName(a?"TrashIcon":"DownloadIcon")),h({hasPlugin:!!b.plugins[i],pending:!1})};if(!a&&n.bunny?.broken)return O.showConfirmationAlert({title:"Are you sure?",content:"This plugin is marked as broken and may break Discord completely.",confirmText:"Install anyway",cancelText:"Cancel",onConfirm:w});if(!a&&n.bunny?.warning)return O.showConfirmationAlert({title:"Are you sure?",content:"This plugin might cause crashes or is already implemented natively.",confirmText:"Install anyway",cancelText:"Cancel",onConfirm:w});w()};return e.React.createElement(ee,{headerLabel:n.name,headerSuffix:e.React.createElement(e.React.Fragment,null,f&&e.React.createElement(N,{variant:"primary",style:{marginLeft:4},shiny:!0},l.format("browser.plugin.new",{})),n.bunny?.broken&&e.React.createElement(N,{variant:"danger",style:{marginLeft:4}},"Broken"),n.bunny?.warning&&!n.bunny?.broken&&e.React.createElement(N,{variant:"danger",style:{marginLeft:4}},"Warning")),headerSublabel:n.authors?.length?`by ${n.authors.map(function(a){return a.name}).join(", ")}`:void 0,headerIcon:o.getAssetIDByName(n.vendetta.icon??""),descriptionLabel:n.description,overflowTitle:n.name,actions:[{icon:c.hasPlugin?"TrashIcon":"DownloadIcon",loading:c.pending,isDestructive:c.hasPlugin,onPress:R}],overflowActions:[{label:l.format(c.hasPlugin?"sheet.plugin.uninstall":"sheet.plugin.install",{}),icon:c.hasPlugin?"TrashIcon":"DownloadIcon",isDestructive:c.hasPlugin,onPress:R},{label:l.format("sheet.plugin.copy_plugin_link",{}),icon:"CopyIcon",onPress:function(){m.showToast(l.format("toast.copy_link",{}),o.getAssetIDByName("CopyIcon")),e.clipboard.setString(i)}},...r?[{label:l.format("sheet.plugin.open_github",{}),icon:"img_account_sync_github_white",onPress:async function(){m.showToast(l.format("toast.open_link",{}),o.getAssetIDByName("LinkExternalSmallIcon"));try{if(await e.ReactNative.Linking.canOpenURL("https://github.com")){const a=await fetch(r,{redirect:"follow"});e.ReactNative.Linking.openURL(a.url)}else e.url.openURL(r)}catch{e.url.openURL(r)}}}]:[]]})}var ne="4e4bdb9f9a50874b.png",ae="10f7b6af6da32586.png",ie="ebdfb66d2006204e.png",re="d9cbba0c467c3f71.png";function ce(){return e.React.createElement(e.ReactNative.Image,{style:{width:16,height:16,tintColor:G.resolveSemanticColor(S.semanticColors.INTERACTIVE_NORMAL)},source:o.getAssetIDByName("search")})}function le(t){let{onChangeText:n,filterSetSort:u,inputRef:i}=t;const[r,f]=e.React.useState(""),[c,h]=e.React.useState(!1),R=function(a){f(a),n(a)};return e.React.createElement(M.ErrorBoundary,null,e.React.createElement(e.ReactNative.View,{style:{flexDirection:"row",justifyContent:"center",gap:8,marginBottom:5}},e.React.createElement(e.ReactNative.View,{style:{flexGrow:1}},e.React.createElement(v.TextInput,{grow:!0,isClearable:!0,leadingIcon:ce,placeholder:Z.SEARCH,onChange:R,returnKeyType:"search",size:"md",autoCapitalize:"none",autoCorrect:!1,value:r,isRound:!0,onFocus:function(){return h(!0)},onBlur:function(){return h(!1)},ref:i})),!c&&!r&&e.React.createElement(v.ContextMenu,{title:l.format("sheet.sort.title",{}),items:Object.values(oe).map(function(a){return{label:l.format(a,{}),variant:"default",action:function(){return u.current(a)},iconSource:{"sheet.sort.date_newest":ne,"sheet.sort.date_oldest":ae,"sheet.sort.name_az":ie,"sheet.sort.name_za":re}[a]}})},function(a){return e.React.createElement(v.IconButton,{icon:o.getAssetIDByName("FiltersHorizontalIcon"),size:"md",variant:"tertiary",...a})})))}var oe=function(t){return t.DateNewest="sheet.sort.date_newest",t.DateOldest="sheet.sort.date_oldest",t.NameAZ="sheet.sort.name_az",t.NameZA="sheet.sort.name_za",t}({});const ue=d.Reanimated.default.createAnimatedComponent(v.IconButton);function se(){const[t,n]=e.React.useState(null),[u,i]=e.React.useState(""),[r,f]=e.React.useState("sheet.sort.date_newest"),c=e.React.useRef(f);c.current=f;const h=e.React.useRef(P()),R=e.React.useRef(),a=e.React.useRef(),[w,B]=e.React.useState(!1),he=e.React.useMemo(function(){if(!t)return[];if(u)return W.go(u,t,{keys:["vendetta.original","name","description","authors.0.name","authors.1.name","authors.2.name"]}).map(function(p){return p.obj});let y=t.slice();return["sheet.sort.name_az","sheet.sort.name_za"].includes(r)&&(y=y.sort(function(p,C){return p.name<C.name?-1:p.name>C.name?1:0})),["sheet.sort.name_za","sheet.sort.date_newest"].includes(r)&&y.reverse(),y},[r,t,u]);return e.React.useEffect(function(){return function(){K()}},[]),e.React.useEffect(function(){t||j.safeFetch(`${T.proxyUrl}plugins-full.json`,{cache:"no-store"}).then(function(y){return y.json().then(function(p){return p.map(function(C){return{...C,vendetta:{...C.vendetta,original:D(C.vendetta.original)}}})}).then(function(p){$(p),h.current=P(),n(p)}).catch(function(){m.showToast(l.format("toast.data.fail_parse",{}),o.getAssetIDByName("CircleXIcon-primary"))})}).catch(function(){m.showToast(l.format("toast.data.fail_fetch",{}),o.getAssetIDByName("CircleXIcon-primary"))})},[t]),Y.managePage({title:l.format("plugin.name",{}),headerRight:function(){return w?e.React.createElement(ue,{icon:o.getAssetIDByName("ArrowSmallUpIcon"),variant:"secondary",size:"sm",onPress:function(){return R.current?.scrollToOffset({animated:!0,offset:0}),a.current?.focus()},entering:d.Reanimated.FadeIn.duration(200),exiting:d.Reanimated.FadeOut.duration(200)}):null}},null,[w]),e.React.createElement(d.FlashList,{ListHeaderComponent:e.React.createElement(le,{onChangeText:i,filterSetSort:c,inputRef:a}),ItemSeparatorComponent:function(){return e.React.createElement(e.ReactNative.View,{style:{height:8}})},contentContainerStyle:{paddingHorizontal:10},data:he,estimatedItemSize:113,renderItem:function(y){let{item:p}=y;return e.React.createElement(te,{item:p,changes:h.current})},removeClippedSubviews:!0,refreshControl:e.React.createElement(e.ReactNative.RefreshControl,{refreshing:t===null,onRefresh:function(){return t!==null&&n(null)}}),onScroll:function(y){return B(y.nativeEvent.contentOffset.y>=45)}})}function ge(){const t=new Array;return t.push(X.patchSettingsPin({key:H.plugin.manifest.name,icon:o.getAssetIDByName(z.manifest.vendetta?.icon??""),trailing:function(){const n=e.React.useRef(Object.keys(P()).length).current;if(n>0)return e.React.createElement(N,{variant:"danger"},n)},title:function(){return l.format("plugin.name",{})},predicate:function(){return!0},page:se})),t.push(J()),t.push(l.unload),function(){for(const n of t)n()}}const k=z.storage,l=new V.Lang("plugin_browser");let U;var fe={onLoad:function(){k.pluginCache??=[],U=ge()},onUnload:function(){return U?.()}};return E.default=fe,E.lang=l,E.vstorage=k,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.plugin,lang$1,vendetta,vendetta.metro.common,vendetta.ui.assets,g,pinToSettings,vendetta.ui.toasts,vendetta.utils,I,deps,redesign,ui$1,vendetta.plugins,vendetta.ui.alerts,vendetta.ui,vendetta.ui.components,ActionSheet,s,types,S$1);
