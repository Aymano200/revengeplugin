(function(C,$,U,V,t,s,_,H,v,z,X,g,R,W,m,j,E,O,M,L,F,Y){"use strict";var T={proxyUrl:"https://raw.githubusercontent.com/shipwr3ckd/plugin-tests/master/",customLinks:{"revenge.nexpid.xyz":function(e){return`https://github.com/nexpid/RevengePlugins/tree/main/src/plugins/${e.join("/")}`},"mugman.catvibers.me":function(e){return`https://github.com/mugman174/${e[0]}/tree/master/plugins/${e.slice(1).join("/")}`},"plugins.obamabot.me":function(e){return`https://github.com/WolfPlugs/${e[0]}/tree/master/${e.slice(1).join("/")}`}}};function N(e){return e.endsWith("/")?e:`${e}/`}const S={origin:/^([^/]+)\/(.*)/,multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/,rawGithub:/^raw\.githubusercontent\.com\/([^/]+)\/([^/]+)\/([^/]+)\/(.+)$/};function Z(e){const n=e.match(S.multiplePluginGitio);if(n?.[0])return`https://github.com/${n[1]}/${n[2]}/tree/master/plugins/${n[3]}`;const i=e.match(S.singlePluginGitio)??e.match(S.githubReleases);if(i?.[0])return`https://github.com/${i[1]}/${i[2]}`;const l=e.match(S.rawGithub);if(l?.[0]){const[,r,u,f,a]=l;return`https://github.com/${r}/${u}/tree/${f}/${a.replace(/\/$/,"")}`}const o=e.match(S.origin);if(o){const[,r,u]=o;if(T.customLinks[r])return T.customLinks[r](u.split("/"))}}let D=new Array;function P(){return!D[0]||!k.pluginCache[0]?[]:D.filter(function(e){return!k.pluginCache.includes(e)})}function q(){k.pluginCache=D}async function B(e){D=(e??await(await z.safeFetch(`${T.proxyUrl}plugins.json`,{cache:"no-store"})).json()).map(function(n){return N(typeof n=="string"?n:n.vendetta.original)})}function K(){const e=setInterval(B,36e5);return B(),function(){clearInterval(e)}}const{FormRow:J}=O.Forms,A=t.stylesheet.createThemedStyleSheet({card:{padding:16,borderRadius:16,borderColor:E.semanticColors.BORDER_FAINT,borderWidth:1,backgroundColor:E.semanticColors.CARD_PRIMARY_BG},content:{flexDirection:"row",alignItems:"center",flex:1},title:{flexDirection:"row",alignItems:"center",gap:6,flexShrink:1},pluginIcon:{tintColor:E.semanticColors.LOGO_PRIMARY,width:18,height:18},actions:{flexDirection:"row-reverse",alignItems:"center",gap:5}});function Q(e){const n=A.card.backgroundColor,i=F.lerp(n,E.rawColors.BRAND_500,.08),l=g.Reanimated.useSharedValue(n);return t.React.useEffect(function(){l.value=n,e.highlight&&(l.value=g.Reanimated.withSequence(g.Reanimated.withTiming(i,{duration:500,easing:g.Reanimated.Easing.cubic}),g.Reanimated.withTiming(n,{duration:500,easing:g.Reanimated.Easing.cubic})))},[e.highlight]),t.React.createElement(g.Reanimated.default.View,{style:[A.card,{backgroundColor:l},e.broken&&{opacity:.5},e.warning&&{opacity:.7}]},t.React.createElement(R.Stack,{spacing:16},t.React.createElement(t.ReactNative.View,{style:A.content},t.React.createElement(R.Stack,{spacing:0,style:{flex:1}},t.React.createElement(t.ReactNative.View,{style:A.title},e.headerIcon&&t.React.createElement(t.ReactNative.Image,{style:A.pluginIcon,resizeMode:"cover",source:e.headerIcon}),t.React.createElement(L,{variant:"heading-lg/semibold",color:"HEADER_PRIMARY",lineClamp:1,ellipsis:"tail",style:{flexShrink:1}},e.headerLabel),e.headerSuffix),e.headerSublabel&&t.React.createElement(L,{variant:"text-md/semibold",color:"TEXT_MUTED"},e.headerSublabel)),t.React.createElement(t.ReactNative.View,null,t.React.createElement(R.Stack,{spacing:5,direction:"horizontal"},e.actions?.map(function({icon:o,onPress:r,isDestructive:u,loading:f}){return t.React.createElement(R.IconButton,{onPress:r,loading:f,size:"sm",variant:u?"destructive":"secondary",icon:s.getAssetIDByName(o)})}),e.overflowActions&&t.React.createElement(R.IconButton,{onPress:function(){M.showSimpleActionSheet({key:"CardOverflow",header:{title:e.overflowTitle,icon:e.headerIcon&&t.React.createElement(J.Icon,{source:e.headerIcon}),onClose:M.hideActionSheet},options:e.overflowActions?.map(function(o){return{...o,icon:s.getAssetIDByName(o.icon)}})})},size:"sm",variant:"secondary",icon:s.getAssetIDByName("CircleInformationIcon-primary")})))),e.descriptionLabel&&t.React.createElement(L,{variant:"text-md/medium",color:"TEXT_NORMAL"},e.descriptionLabel)))}function ee({item:e,changes:n}){const{usableLink:i,githubLink:l}=t.React.useMemo(function(){return{usableLink:`https://${e.vendetta.original.replace(/^vendetta\.nexpid\.xyz\//,"revenge.nexpid.xyz/")}`,githubLink:Z(e.vendetta.original)}},[e]),o=t.React.useMemo(function(){return n.includes(N(e.vendetta.original))},[n,e]),[r,u]=t.React.useState({hasPlugin:!!m.plugins[i],pending:!1});t.React.useEffect(function(){u({hasPlugin:!!m.plugins[i],pending:!1})},[e,i]);const f=function(){if(r.pending)return;const a=!!m.plugins[i],b=async function(){u(function(x){return{...x,pending:!0}});try{a?m.removePlugin(i):await m.installPlugin(i)}catch{v.showToast(c.format(a?"toast.plugin.delete.fail":"toast.plugin.install.fail",{plugin:e.name}),s.getAssetIDByName("CircleXIcon-primary"))}v.showToast(c.format(a?"toast.plugin.delete.success":"toast.plugin.install.success",{plugin:e.name}),s.getAssetIDByName(a?"TrashIcon":"DownloadIcon")),u({hasPlugin:!!m.plugins[i],pending:!1})};if(!a&&e.bunny?.broken)return j.showConfirmationAlert({title:"Are you sure?",content:"This plugin is marked as broken and may break Discord completely.",confirmText:"Install anyway",cancelText:"Cancel",onConfirm:b});if(!a&&e.bunny?.warning)return j.showConfirmationAlert({title:"Are you sure?",content:"This plugin might cause crashes or is already implemented natively.",confirmText:"Install anyway",cancelText:"Cancel",onConfirm:b});b()};return t.React.createElement(Q,{headerLabel:e.name,headerSuffix:t.React.createElement(t.React.Fragment,null,o&&t.React.createElement(_,{variant:"primary",style:{marginLeft:4},shiny:!0},c.format("browser.plugin.new",{})),e.bunny?.broken&&t.React.createElement(_,{variant:"danger",style:{marginLeft:4}},"Broken"),e.bunny?.warning&&!e.bunny?.broken&&t.React.createElement(_,{variant:"danger",style:{marginLeft:4}},"Warning")),headerSublabel:e.authors?.length?`by ${e.authors.map(function(a){return a.name}).join(", ")}`:void 0,headerIcon:s.getAssetIDByName(e.vendetta.icon??""),descriptionLabel:e.description,overflowTitle:e.name,actions:[{icon:r.hasPlugin?"TrashIcon":"DownloadIcon",loading:r.pending,isDestructive:r.hasPlugin,onPress:f}],overflowActions:[{label:c.format(r.hasPlugin?"sheet.plugin.uninstall":"sheet.plugin.install",{}),icon:r.hasPlugin?"TrashIcon":"DownloadIcon",isDestructive:r.hasPlugin,onPress:f},{label:c.format("sheet.plugin.copy_plugin_link",{}),icon:"CopyIcon",onPress:function(){v.showToast(c.format("toast.copy_link",{}),s.getAssetIDByName("CopyIcon")),t.clipboard.setString(i)}},...l?[{label:c.format("sheet.plugin.open_github",{}),icon:"img_account_sync_github_white",onPress:async function(){v.showToast(c.format("toast.open_link",{}),s.getAssetIDByName("LinkExternalSmallIcon"));try{if(await t.ReactNative.Linking.canOpenURL("https://github.com")){const a=await fetch(l,{redirect:"follow"});t.ReactNative.Linking.openURL(a.url)}else t.url.openURL(l)}catch{t.url.openURL(l)}}}]:[]]})}var te="4e4bdb9f9a50874b.png",ne="10f7b6af6da32586.png",ae="ebdfb66d2006204e.png",ie="d9cbba0c467c3f71.png";function re(){return t.React.createElement(t.ReactNative.Image,{style:{width:16,height:16,tintColor:F.resolveSemanticColor(E.semanticColors.INTERACTIVE_NORMAL)},source:s.getAssetIDByName("search")})}function ce({onChangeText:e,filterSetSort:n,inputRef:i}){const[l,o]=t.React.useState(""),[r,u]=t.React.useState(!1),f=function(a){o(a),e(a)};return t.React.createElement(O.ErrorBoundary,null,t.React.createElement(t.ReactNative.View,{style:{flexDirection:"row",justifyContent:"center",gap:8,marginBottom:5}},t.React.createElement(t.ReactNative.View,{style:{flexGrow:1}},t.React.createElement(R.TextInput,{grow:!0,isClearable:!0,leadingIcon:re,placeholder:Y.SEARCH,onChange:f,returnKeyType:"search",size:"md",autoCapitalize:"none",autoCorrect:!1,value:l,isRound:!0,onFocus:function(){return u(!0)},onBlur:function(){return u(!1)},ref:i})),!r&&!l&&t.React.createElement(R.ContextMenu,{title:c.format("sheet.sort.title",{}),items:Object.values(le).map(function(a){return{label:c.format(a,{}),variant:"default",action:function(){return n.current(a)},iconSource:{"sheet.sort.date_newest":te,"sheet.sort.date_oldest":ne,"sheet.sort.name_az":ae,"sheet.sort.name_za":ie}[a]}})},function(a){return t.React.createElement(R.IconButton,{icon:s.getAssetIDByName("FiltersHorizontalIcon"),size:"md",variant:"tertiary",...a})})))}var le=function(e){return e.DateNewest="sheet.sort.date_newest",e.DateOldest="sheet.sort.date_oldest",e.NameAZ="sheet.sort.name_az",e.NameZA="sheet.sort.name_za",e}({});const oe=g.Reanimated.default.createAnimatedComponent(R.IconButton);function ue(){const[e,n]=t.React.useState(null),[i,l]=t.React.useState(""),[o,r]=t.React.useState("sheet.sort.date_newest"),u=t.React.useRef(r);u.current=r;const f=t.React.useRef(P()),a=t.React.useRef(),b=t.React.useRef(),[x,fe]=t.React.useState(!1),he=t.React.useMemo(function(){if(!e)return[];if(i)return X.go(i,e,{keys:["vendetta.original","name","description","authors.0.name","authors.1.name","authors.2.name"]}).map(function(y){return y.obj});let p=e.slice();return["sheet.sort.name_az","sheet.sort.name_za"].includes(o)&&(p=p.sort(function(y,w){return y.name<w.name?-1:y.name>w.name?1:0})),["sheet.sort.name_za","sheet.sort.date_newest"].includes(o)&&p.reverse(),p},[o,e,i]);return t.React.useEffect(function(){return function(){q()}},[]),t.React.useEffect(function(){e||z.safeFetch(`${T.proxyUrl}plugins-full.json`,{cache:"no-store"}).then(function(p){return p.json().then(function(y){return y.map(function(w){return{...w,vendetta:{...w.vendetta,original:N(w.vendetta.original)}}})}).then(function(y){B(y),f.current=P(),n(y)}).catch(function(){v.showToast(c.format("toast.data.fail_parse",{}),s.getAssetIDByName("CircleXIcon-primary"))})}).catch(function(){v.showToast(c.format("toast.data.fail_fetch",{}),s.getAssetIDByName("CircleXIcon-primary"))})},[e]),W.managePage({title:c.format("plugin.name",{}),headerRight:function(){return x?t.React.createElement(oe,{icon:s.getAssetIDByName("ArrowSmallUpIcon"),variant:"secondary",size:"sm",onPress:function(){return a.current?.scrollToOffset({animated:!0,offset:0}),b.current?.focus()},entering:g.Reanimated.FadeIn.duration(200),exiting:g.Reanimated.FadeOut.duration(200)}):null}},null,[x]),t.React.createElement(g.FlashList,{ListHeaderComponent:t.React.createElement(ce,{onChangeText:l,filterSetSort:u,inputRef:b}),ItemSeparatorComponent:function(){return t.React.createElement(t.ReactNative.View,{style:{height:8}})},contentContainerStyle:{paddingHorizontal:10},data:he,estimatedItemSize:113,renderItem:function({item:p}){return t.React.createElement(ee,{item:p,changes:f.current})},removeClippedSubviews:!0,refreshControl:t.React.createElement(t.ReactNative.RefreshControl,{refreshing:e===null,onRefresh:function(){return e!==null&&n(null)}}),onScroll:function(p){return fe(p.nativeEvent.contentOffset.y>=45)}})}function se(){const e=new Array;return e.push(H.patchSettingsPin({key:V.plugin.manifest.name,icon:s.getAssetIDByName($.manifest.vendetta?.icon??""),trailing:function(){const n=t.React.useRef(Object.keys(P()).length).current;if(n>0)return t.React.createElement(_,{variant:"danger"},n)},title:function(){return c.format("plugin.name",{})},predicate:function(){return!0},page:ue})),e.push(K()),e.push(c.unload),function(){for(const n of e)n()}}const k=$.storage,c=new U.Lang("plugin_browser");let G;var ge={onLoad:function(){k.pluginCache??=[],G=se()},onUnload:function(){return G?.()}};return C.default=ge,C.lang=c,C.vstorage=k,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.plugin,lang$1,vendetta,vendetta.metro.common,vendetta.ui.assets,p$1,pinToSettings,vendetta.ui.toasts,vendetta.utils,I,deps,redesign,ui$1,vendetta.plugins,vendetta.ui.alerts,vendetta.ui,vendetta.ui.components,ActionSheet,d,types,h);
