(function(d,h,u,t,s,m,o,v,l,g){"use strict";const{useState:I}=s.React,{FormRow:w,FormSwitchRow:L,FormSection:A,FormDivider:D,FormInput:R,FormIcon:y}=m.Forms,{TouchableOpacity:S}=s.ReactNative,b=s.stylesheet.createThemedStyleSheet({input:{marginHorizontal:16,marginVertical:8}});function p(a){return/^\d{17,19}$/.test(a)}function F(){v.useProxy(t.storage);const[a,r]=I("");t.storage.silentList??=[],t.storage.alwaysSilent??=!1;const i=function(){const e=a.trim();if(!p(e)){l.showToast("Invalid User ID!",o.getAssetIDByName("server-error"));return}t.storage.silentList.includes(e)?l.showToast("User ID already in the list"):(t.storage.silentList=[...t.storage.silentList,e],r(""))},n=function(e){t.storage.silentList=t.storage.silentList.filter(function(c){return c!==e})};return s.React.createElement(s.React.Fragment,null,s.React.createElement(L,{label:"Always send silently",subLabel:"All of your messages will be sent silently.",leading:s.React.createElement(y,{source:o.getAssetIDByName("ic_noise_cancellation_disabled")}),value:!!t.storage.alwaysSilent,onValueChange:function(e){return t.storage.alwaysSilent=e}}),s.React.createElement(D,null),s.React.createElement(R,{title:"Add User ID",placeholder:"123456789012345678",value:a,keyboardType:"numeric",onChangeText:function(e){return r(e.replace(/[^0-9]/g,""))},onSubmitEditing:i,style:b.input}),s.React.createElement(A,{title:"Silenced User/Channel IDs"},t.storage.silentList.map(function(e){return s.React.createElement(w,{key:e,label:e,trailing:s.React.createElement(S,{onPress:function(){return n(e)}},s.React.createElement(y,{source:o.getAssetIDByName("ic_trash_24px")}))})})))}const C=u.findByProps("getChannel","getDMFromUserId"),E=function(){g.registerCommand({name:"silent",description:"Toggle silent messaging",options:[],execute:function(a,r){const i=r?.channel?.id,n=C.getChannel(i),e=Array.isArray(n?.recipients)?n.recipients.find(function(P){return P!==n?.ownerId}):n?.id;if(!e){l.showToast("Failed to get user ID for this DM/group.",o.getAssetIDByName("failure-header"));return}t.storage.silentList??=[];const c=t.storage.silentList.indexOf(e);c===-1?(t.storage.silentList.push(e),l.showToast("Added to silent list.",o.getAssetIDByName("success-header"))):(t.storage.silentList.splice(c,1),l.showToast("Removed from silent list.",o.getAssetIDByName("ic_trash_24px")))}})},B=function(){return g.unregisterAllCommands()},T=u.findByProps("sendMessage"),_=u.findByProps("getChannel","getDMFromUserId");t.storage.alwaysSilent??=!1,t.storage.silentList??=[];function N(a,r){const i=_.getChannel(a),n=[];if(!i)return r.map(function(e){return e?.id}).filter(Boolean);Array.isArray(i.recipients)?n.push(...i.recipients):n.push(a);for(const e of r)e?.id&&!n.includes(e.id)&&n.push(e.id);return n}let f;var M={onLoad(){f=h.before("sendMessage",T,function([a,r]){const i=r?.mentions||[],n=N(a,i);(t.storage.alwaysSilent||n.some(function(e){return t.storage.silentList.includes(e)}))&&typeof r.content=="string"&&!r.content.startsWith("@silent ")&&(r.content=`@silent ${r.content}`)}),E?.()},onunload(){f&&f(),B?.()},settings:F};return d.default=M,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.patcher,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.storage,vendetta.ui.toasts,vendetta.commands);
