(function(E,d,i,a,f,c,p,v,R){"use strict";const{Permissions:N}=a.constants,{computePermissions:_}=i.findByProps("computePermissions","canEveryoneRole"),T=i.findByStoreName("GuildMemberStore"),y=[a.i18n.Messages.AI_TAG,a.i18n.Messages.BOT_TAG_SERVER,a.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,a.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,a.i18n.Messages.REMIXING_TAG],x=[{text:"WEBHOOK",condition:function(e,r,o){return o.isNonUserBot()}},{text:"OWNER",backgroundColor:c.rawColors.ORANGE_345,condition:function(e,r,o){return e?.ownerId===o.id}},{text:a.i18n.Messages.BOT_TAG_BOT,condition:function(e,r,o){return o.bot},verified:function(e,r,o){return o.isVerifiedBot()}},{text:"ADMIN",backgroundColor:c.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:c.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:c.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function B(e,r,o){let s;if(e){const t=_({user:o,context:e,overwrites:r?.permissionOverwrites});s=Object.entries(N).map(function([n,l]){return t&l?n:""}).filter(Boolean)}for(const t of x)if(t.condition?.(e,r,o)||t.permissions?.some(function(n){return s?.includes(n)})){let n=d.storage.useRoleColor?T.getMember(e?.id,o.id)?.colorString:void 0,l=n||(t.backgroundColor??c.rawColors.BRAND_500),C=n||!t.textColor?a.chroma(l).get("lab.l")<70?c.rawColors.WHITE_500:c.rawColors.BLACK_500:t.textColor;return{...t,textColor:C,backgroundColor:l,verified:typeof t.verified=="function"?t.verified(e,r,o):t.verified??!1,condition:void 0,permissions:void 0}}}const A=i.findByName("getTagProperties",!1),b=i.findByStoreName("GuildStore"),M=i.findByStoreName("ChannelStore");function G(){return f.after("default",A,function([{message:e}],r){if(!y.includes(r.tagText)){const o=M.getChannel(e.channel_id),s=b.getGuild(o?.guild_id),t=B(s,o,e.author);if(t)return{...r,tagText:t.text,tagTextColor:t.textColor?a.ReactNative.processColor(a.chroma(t.textColor).hex()):void 0,tagBackgroundColor:t.backgroundColor?a.ReactNative.processColor(a.chroma(t.backgroundColor).hex()):void 0,tagVerified:t.verified,tagType:void 0}}})}const S=i.findByProps("getBotLabel"),I=S.getBotLabel,O=i.findByStoreName("GuildStore"),k=function([{guildId:e,user:r}],o){console.log(o);const s=p.findInReactTree(o.props.label,function(t){return t.type.Types});if(!s||!y.includes(I(s.props.type))){const t=O.getGuild(e),n=B(t,void 0,r);if(n)if(s)s.props={type:0,...n};else{const l=p.findInReactTree(o.props.label,function(C){return C.props?.lineClamp}).props.children;l.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(S.default,{type:0,text:n.text,textColor:n.textColor,backgroundColor:n.backgroundColor,verified:n.verified}))}}};function m(){const e=[];return i.findByTypeNameAll("UserRow").forEach(function(r){return e.push(f.after("type",r,k))}),function(){return e.forEach(function(r){return r()})}}const w=i.findByName("DisplayName",!1),L=i.findByName("HeaderName",!1),h=i.findByProps("getBotLabel"),D=h.getBotLabel,P=i.findByStoreName("GuildStore"),U=i.findByStoreName("ChannelStore");function $(){const e=[];return e.push(f.after("default",L,function([{channelId:r}],o){o.props.channelId=r})),e.push(f.after("default",w,function([{guildId:r,channelId:o,user:s}],t){const n=p.findInReactTree(t,function(l){return l.type.Types});if(!n||!y.includes(D(n.props.type))){const l=P.getGuild(r),C=U.getChannel(o),u=B(l,C,s);u&&(n?n.props={type:0,...u}:p.findInReactTree(t,function(Y){return Y.props.style.flexDirection==="row"}).props.children.push(React.createElement(h.default,{style:{marginLeft:0},type:0,text:u.text,textColor:u.textColor,backgroundColor:u.backgroundColor,verified:u.verified})))}})),function(){return e.forEach(function(r){return r()})}}const H=i.findByProps("getBotLabel");function K(){return f.after("default",H,function([{text:e,textColor:r,backgroundColor:o}],s){const t=p.findInReactTree(s,function(n){return typeof n.props.children=="string"});e&&(t.props.children=e),r&&t.props.style.push({color:r}),o&&s.props.style.push({backgroundColor:o})})}const{ScrollView:V}=R.General,{FormSection:F,FormSwitchRow:W}=R.Forms;function j(){return v.useProxy(d.storage),React.createElement(V,{style:{flex:1}},React.createElement(F,{title:"Tag style"},React.createElement(W,{label:"Use top role color for tag backgrounds",value:d.storage.useRoleColor,onValueChange:function(e){d.storage.useRoleColor=e}})))}let g=[];var X={onLoad:function(){d.storage.useRoleColor??=!1,g.push(G()),g.push(K()),g.push($()),g.push(m())},onUnload:function(){return g.forEach(function(e){return e()})},settings:j};return E.default=X,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
